<!DOCTYPE HTML>
<html>
<head>
    <title>@ PROJETOS A3 | MELHORIA CONTÍNUA </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css" />
    </noscript>
    <!-- Favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
	<link rel="icon" type="images/png" sizes="32x32" href="images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
	<link rel="icon" href="image/favicon.ico">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css" />
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.css" />
</head>

<body class="is-preload">
	<!-- Page Wrapper -->
	<div id="page-wrapper">
		<!-- Header -->
		<header id="header" class="alt">
			<div style="float: left;">
				<h1><a href="homepage.html" class="image"><img src="images/LogoComfrio.png" style="width: 100px; height: auto;"></a></h1>
			</div>
			<div style="margin: 0 auto; padding-left: 7em;">
				<h1 style="color: #616163; font-size: 900;">PROJETOS A3 | CORPORATIVO</h1>
			</div>
			<nav style="display: flex; align-items: center;">
				<div id="sectorContainer"
					style="display: none; position: absolute; top: 100%; left: 0; background-color: white; border-radius: 10px; box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);">
					<div id="sectorInfo"></div>
				</div>
				<span id="loginDropdown" style="position: relative;">
					<a href="#" onclick="toggleDropdown(event)"
						style="background-color: white; border-radius: 10px; color: black; box-shadow: 0px 0px 5px rgba(0, 0, 0, 1)"
						onmouseover="changeBackgroundColor(true)" onmouseout="changeBackgroundColor(false)">
						<i class="fas fa-cog"></i></a>
					<!-- Dropdown de opções -->
					<div id="dropdownContent">
						<a href="#" onclick="showLoadingModal()" id="sairBtn"
							style="display: flex; align-items: center;">
							<span style="margin-right: auto;">Sair</span>
							<i class="fas fa-times" style="margin-left: 5px;"></i>
						</a>
						<!-- Outras opções de logout aqui -->
					</div>
				</span>
			</nav>
		</header>
		<!-- Modal de barra de carregamento -->
		<div id="loaderModal" class="modal">
			<div class="modal-content">
				<div class="loader"></div>
				<h2 id="loadingText" style="font-size: larger; font-weight: bolder; color: white;">REDIRECIONANDO...
				</h2>
			</div>
		</div>
		<script>
			function searchSector() {
				var searchTerm = document.getElementById('searchInput').value.toLowerCase();
				var sectors = document.getElementsByClassName('major-inicio');
				var matches = [];
				for (var i = 0; i < sectors.length; i++) {
					var sector = sectors[i].innerText.toLowerCase();
					if (sector.includes(searchTerm)) {
						matches.push(sectors[i]);
					}
				}
				var sectorContainer = document.getElementById('sectorContainer');
				var sectorInfo = document.getElementById('sectorInfo');
				if (matches.length > 0) {
					var dropdownContent = '<ul>';
					for (var j = 0; j < matches.length; j++) {
						dropdownContent += '<li><a href="#' + matches[j].innerText.replace(/\s+/g, '-') + '">' + matches[j].innerText + '</a></li>';
					}
					dropdownContent += '</ul>';
					sectorInfo.innerHTML = dropdownContent;
					sectorContainer.style.display = 'block';
				} else {
					sectorContainer.style.display = 'none';
				}
			}
			function changeBackgroundColor(isHover) {
				var loginLink = document.getElementById("loginDropdown").querySelector("a");
				if (isHover) {
					loginLink.style.backgroundColor = "#616163";
					loginLink.style.color = "white";
				} else {
					loginLink.style.backgroundColor = "white";
					loginLink.style.color = "black";
				}
			}
			function toggleDropdown(event) {
				event.preventDefault();
				var dropdown = document.getElementById("dropdownContent");
				if (dropdown.style.display === "none" || dropdown.style.display === "") {
					dropdown.style.display = "block";
				} else {
					dropdown.style.display = "none";
				}

				if (event.target.textContent === "Sair") {
					document.getElementById("logoutModal").style.display = "block";
					// Simule um atraso para a barra de carregamento
					setTimeout(function () {
						// Aqui você pode redirecionar o usuário para a página de login ou executar outras ações de logout
						// window.location.href = "pagina_de_login.html";
						// Por enquanto, vamos apenas esconder o modal
						document.getElementById("logoutModal").style.display = "none";
						dropdown.style.display = "none"; // Esconder o menu após o logout
					}, 2000); // Tempo simulado de 2 segundos
				}
			}
			var isExpanded = false;
			var collapseTimeout;
		</script>
		<!-- Banner -->
		<section id="banner" style="position: relative; overflow: hidden;">
			<!-- Fundo com blur -->
			<div style="
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-image: url('images/projetosa3.jpg');
			background-size: cover;
			background-position: center;
			filter: blur(5px) brightness(0.5); /* Desfoque e escurecimento */
			z-index: -1;
		">
		</div>
			<!-- Conteúdo -->
			<div class="inner" style="position: relative; text-align: center; padding: 20px;">
				<h2 style="color:#fff; margin: 0;">LISTA MESTRA | EXC. OPERACIONAL</h2>
			</div>
		</section>
		<!-- Wrapper -->
		<section id="wrapper">
	</div>
</section>
			<!-- One -->
			<section id="one" class="wrapper spotlight style1" style="padding: 20px 8em 0em 8em; position: relative; display: flex; flex-wrap: wrap; background-image: url('images/background-logo.jpg');
			background-size: cover;
			background-position: left center; /* ajustado para a direita e centralizado verticalmente */
			background-repeat: no-repeat;">
				<div class="table-wrapper" style="width: 100%; color: white; display: flex; justify-content: center; align-items: center; flex-direction: column;">
					<div>
						<div>
							<h2 style="color: #616163; margin: 0; padding: 0; align-self: center;">NAVEGUE PELOS PROJETOS ELABORADOS </h2>
						</div>
					</div>
					<style>
						#default-table tbody tr:nth-child(even) {
							background-color: #fefefe;
							box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.4);
							/* Define a cor de fundo para linhas pares */
						}
					</style>
					<!-- Formulário para adicionar documento -->
<section style="margin: 2em auto; width: 90%; max-width: 800px; background: #f9f9f9; padding: 1em; border-radius: 8px; box-shadow: 0 0 10px #ccc;">
  <h3 style="color: #616163;">Adicionar Novo Documento</h3>
  <form id="formAdicionarDocumento">
    <input type="text" id="tituloInput" placeholder="Título" required />
    <input type="text" id="autorInput" placeholder="Autor" required />
    <input type="date" id="dataInput" required />
    <input type="file" id="arquivoInput" accept=".pdf,.doc,.docx,.xls,.xlsx" required />
    <button type="submit">Adicionar Documento</button>
  </form>
  <p id="statusMessage" style="color: green; font-weight: bold; margin-top: 0.5em;"></p>
</section>
<script>
  const form = document.getElementById("formAdicionarDocumento");
  const statusMessage = document.getElementById("statusMessage");
  const arquivoInput = document.getElementById("arquivoInput");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const titulo = document.getElementById("tituloInput").value.trim();
    const autor = document.getElementById("autorInput").value.trim();
    const data_criacao = document.getElementById("dataInput").value;

    if (!arquivoInput.files.length) {
      statusMessage.style.color = "red";
      statusMessage.textContent = "Por favor, selecione um arquivo.";
      return;
    }

    const arquivo = arquivoInput.files[0];

    try {
      statusMessage.style.color = "black";
      statusMessage.textContent = "Fazendo upload do arquivo...";

      // Referência ao Firebase Storage na pasta documentos
      const storageRef = firebase.storage().ref();
      const arquivoRef = storageRef.child('documentos/' + Date.now() + '_' + arquivo.name);

      // Upload do arquivo
      const snapshot = await arquivoRef.put(arquivo);

      // Pega a URL pública do arquivo
      const urlArquivo = await snapshot.ref.getDownloadURL();

      // Salva no Firestore com a URL do arquivo
      await db.collection("documentos").add({
        titulo,
        autor,
        data_criacao,
        conteudo: urlArquivo
      });

      statusMessage.style.color = "green";
      statusMessage.textContent = "Documento adicionado com sucesso!";
      form.reset();
      carregarTabela(); // Atualiza tabela

    } catch (error) {
      console.error("Erro ao adicionar documento:", error);
      statusMessage.style.color = "red";
      statusMessage.textContent = "Erro ao adicionar documento. Veja o console.";
    }
  });
// Função para carregar e popular a tabela, com botão de excluir
async function carregarTabela() {
  const tbody = document.getElementById("projectsTableBody");
  tbody.innerHTML = ""; // limpa tabela

  try {
    const querySnapshot = await db.collection("documentos").get();

    querySnapshot.forEach(doc => {
      const data = doc.data();
      const docId = doc.id;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.titulo || ""}</td>
        <td>${data.autor || ""}</td>
        <td>${data.conteudo ? `<a href="${data.conteudo}" target="_blank">Abrir arquivo</a>` : ''}</td>
        <td>${data.data_criacao || ""}</td>
        <td>
          <button data-id="${docId}" class="btnExcluir" style="background-color:#c0392b; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">
            Excluir
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });

    // Depois de inserir as linhas, adiciona os event listeners aos botões excluir
    const botoesExcluir = document.querySelectorAll(".btnExcluir");

    botoesExcluir.forEach(botao => {
      botao.addEventListener("click", async (e) => {
        const id = e.target.getAttribute("data-id");

        if (confirm("Tem certeza que quer excluir este documento?")) {
          try {
            // 1. Busca o documento no Firestore
            const docRef = db.collection("documentos").doc(id);
            const doc = await docRef.get();

            if (!doc.exists) {
              alert("Documento não encontrado.");
              return;
            }

            const data = doc.data();
            const urlArquivo = data.conteudo;

            // 2. Exclui o arquivo do Firebase Storage, se existir
            if (urlArquivo) {
              const storageRef = firebase.storage().refFromURL(urlArquivo);
              await storageRef.delete();
              console.log("Arquivo excluído do Storage.");
            }

            // 3. Exclui o documento do Firestore
            await docRef.delete();
            alert("Documento e arquivo excluídos com sucesso!");

            // 4. Atualiza a tabela
            carregarTabela();

          } catch (error) {
            console.error("Erro ao excluir:", error);
            alert("Erro ao excluir o documento ou o arquivo. Veja o console.");
          }
        }
      });
    });

  } catch (error) {
    console.error("Erro ao buscar documentos:", error);
    tbody.innerHTML = `<tr><td colspan="5" style="color:red; text-align:center;">Erro ao carregar documentos</td></tr>`;
  }
}

// Chama a função ao carregar a página
document.addEventListener("DOMContentLoaded", carregarTabela);
</script>
<table id="default-table" style="background-color: white; text-align: center;">			
<thead style="background-color: #2e3141; box-shadow: 0px 0px 15px rgba(0, 0, 0, 1);">
  <tr>
    <th style="text-align: center; padding-top: 1em;">Título</th>
    <th style="text-align: center;">Autor</th>
    <th style="text-align: center;">Conteúdo</th>
    <th style="text-align: center;">Data</th>
    <th style="text-align: center;">Ações</th> <!-- nova coluna -->
  </tr>
</thead>
						<tbody id="projectsTableBody" style="font-weight: bold; color: #666666; background-color: white; box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.4);">
						<!-- Linhas da tabela aqui -->
						</tbody>
							<script>
							const tbody = document.getElementById("projectsTableBody");
							tbody.innerHTML = ""; // limpa tabela
							db.collection("documentos").get().then(querySnapshot => {
								querySnapshot.forEach(doc => {
								const data = doc.data();
								const tr = document.createElement("tr");
								tr.innerHTML = `
									<td>${data.titulo || ""}</td>
									<td>${data.autor || ""}</td>
									<td>${data.conteudo || ""}</td>
									<td>${data.data_criacao || ""}</td>
								`;
								tbody.appendChild(tr);
								});
							}).catch(error => {
								console.error("Erro ao buscar documentos:", error);
								tbody.innerHTML = `<tr><td colspan="4" style="color:red; text-align:center;">Erro ao carregar documentos</td></tr>`;
							});
							</script>
						</tbody>
					</table>
					<ul class="actions">
						<a href="homepage.html" class="special" style="margin: 0;">VOLTAR</a>
					</ul>
				</div>
				</div>
			</div>
			</section>
	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.scrollex.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		const filterButtons = document.querySelectorAll(".filter-btn");
		const painelCards = document.querySelectorAll("#painel-container .inner");
		filterButtons.forEach(button => {
			button.addEventListener("click", function () {
				// Remove 'active' de todos os botões
				filterButtons.forEach(btn => btn.classList.remove("active"));
				// Adiciona 'active' ao botão clicado
				this.classList.add("active");
				const filtro = this.getAttribute("data-filter");
				painelCards.forEach(card => {
					const categoria = card.getAttribute("data-categoria");
					if (filtro === "todos" || filtro === categoria) {
						card.style.display = "flex"; // ou "block", dependendo do layout
					} else {
						card.style.display = "none";
					}
				});
			});
		});
	});
	</script>
	<script>

// Eventos
for (const key in filters) {
    filters[key].addEventListener('change', aplicarFiltros);
}

// Inicialização
window.addEventListener('DOMContentLoaded', () => {
    aplicarFiltros();
});
	</script>
	<a href="#top">
		<svg xmlns="http://www.w3.org/2000/svg" width="25px" height="25px" viewBox="0 0 25 20" data-name="Layer 1">
			<path
				d="M17.71,11.29l-5-5a1,1,0,0,0-.33-.21,1,1,0,0,0-.76,0,1,1,0,0,0-.33.21l-5,5a1,1,0,0,0,1.42,1.42L11,9.41V17a1,1,0,0,0,2,0V9.41l3.29,3.3a1,1,0,0,0,1.42,0A1,1,0,0,0,17.71,11.29Z" />
		</svg>
	</a>
	<style>
		.hidden {
			display: none;
		}
		/* Ajusta o tamanho do ícone dentro dos botões slick-prev e slick-next */
		.slick-prev:before,
		.slick-next:before {
			font-size: 35px;
			/* Define o tamanho do ícone */
		}
		#four .inner {
			margin: 0 auto;
			text-align: center;
			/* Alinha o texto ao centro */
			transform: scale(0.8);
		}
		.actions {
			margin-top: 20px;
			/* Espaçamento superior */
			text-align: center;
			/* Alinha ao centro */
		}
		.image img {
			transition: transform 0.3s ease-out;
			/* ou ease-in ou linear */
		}
		.image img:hover {
			transform: scale(0.98);
		}
		.wrapper.spotlight.style1 {
			display: flex;
			justify-content: space-around;
			/* Ou outro valor de alinhamento, como space-between */
		}
		/* Estilos para o modal */
		.modal {
    display: none; /* Inicialmente invisível */
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px); /* Efeito de fundo borrado */
    justify-content: center;
    align-items: center; /* Centraliza o conteúdo */
}
/* Conteúdo do modal loader */
.modal-content {
    background-color: transparent;
    padding: 20px;
    width: 80%;
    text-align: center;
    border-radius: 10px;
}
/* Estilos para o loader */
.loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #616163; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 1.5s linear infinite;
    margin: auto;
}
		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}
		#painel-container .inner {
  opacity: 1;
  transform: scale(1);
  transition: opacity 0.3s ease, transform 0.3s ease;
}
#painel-container .inner.hide {
  opacity: 0;
  transform: scale(0.95);
  pointer-events: none;
}
.filtros-linha {
    display: flex;
    flex-wrap: wrap;
    gap: 50px;
    justify-content: center;
    margin: 2em 0;
}
.filtro {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    min-width: 10em;
}
.filtro label {
    font-weight: bold;
    color: #616163;
    align-self: center;
}
.select-wrapper {
    position: relative;
    width: 100%;
}
.filtro select {
    padding: 0.5em;
    padding-right: 30px;  /* Espaço para o ícone */
    border-radius: 5px;
    border: 1px solid #ccc;
    width: 100%;
    text-align: center; /* Para IE e alguns navegadores */
    text-align-last: center; /* Para Chrome, Firefox, Edge */
    background-color: white; /* Fundo branco para as opções */
    -webkit-appearance: none; /* Remove a seta no Safari */
    -moz-appearance: none; /* Remove a seta no Firefox */
    appearance: none; /* Remove a seta no Chrome */
    font-weight: bold; /* Torna o texto em negrito */
}
.filtro select option {
    background-color: white; /* Fundo branco para cada opção */
    color: #666;
    font-weight: bold; /* Torna o texto em negrito */
}
/* Adiciona a seta para baixo */
.filtro select::after {
    content: '\f0d7'; /* Código da seta para baixo no FontAwesome */
    font-family: 'FontAwesome';
    font-size: 16px;
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    color: #666;
    pointer-events: none;  /* Garante que o clique não seja afetado pela seta */
}
/* Adiciona borda ao redor de todos os filtros */
.filtros-container {
    border: 1px solid #ccc;  /* Borda cinza */  /* Adiciona um pouco de espaçamento dentro da borda */
    border-radius: 10px;  /* Borda arredondada */
    background-color: #fff; /* Garante fundo branco dentro da borda */
	width: 100%;
}
	</style>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-storage-compat.js"></script>
<script src="auth.js"></script>
<script>
  checkAuth();
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    carregarTabela(); // Chama a função assim que a página carregar
  });
</script>
</body>
</html>